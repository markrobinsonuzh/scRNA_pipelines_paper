---
title: "Figure 5 dimensionality reduction"
author: "Pierre-Luc Germain"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: html_document
---

```{r}
suppressPackageStartupMessages({
  library(ggplot2)
  library(cowplot)
  library(ComplexHeatmap)
  library(matrixStats)
  library(pipeComp)
})
source("../misc_functions.R")
```

```{r, include=FALSE}
devtools::load_all("../../pipeComp/")
```

```{r dimred, fig.width=10.5, fig.height=6}
res <- readRDS("../data/results_dimred2.rds")
H <- renameHrows(
  scrna_evalPlot_silh( res, reorder_rows=TRUE, 
                       heatmap_legend_param=list(direction="horizontal")),
  function(x) gsub("norm\\.","",x))
p1 <- grid.grabExpr(draw(H, heatmap_legend_side="bottom"))

p2 <- renameHrows(
  evalHeatmap( res, what=c("MI","min_pr"), agg.by=c("norm","dr"), reorder_rows=TRUE, anno_legend=FALSE,
               title=c("MI","Minimum precision")) + 
  evalHeatmap(res, what=c("ARI"), agg.by=c("norm","dr"), filterExpr=n_clus==true.nbClusts, 
              anno_legend=FALSE, title="ARI at true k"),
  function(x) gsub("norm\\.","",x)
)
p2 <- grid.grabExpr(draw(p2))

pdf("dr.pdf", width = 10.5, height=6)
plot_grid(p1,p2, nrow=2, labels=LETTERS[1:2])
dev.off()
plot_grid(p1,p2, nrow=2, labels=LETTERS[1:2])
```

Silhouette width (**A**) per subpopulation and clustering accuracy (**B**) according to various normalization and dimension reductions.
